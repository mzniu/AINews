# 爬虫网络问题解决方案

## 当前问题

测试发现机器之心网站（www.jiqizhixin.com）无法直接访问，出现连接超时错误。

## 解决方案

### 方案1: 配置HTTP代理（推荐）

在 `.env` 文件中添加代理配置：

```bash
# 代理配置
HTTP_PROXY=http://127.0.0.1:7890
HTTPS_PROXY=http://127.0.0.1:7890
```

修改 `src/crawlers/base.py`：

```python
import os

class BaseCrawler(ABC):
    def __init__(self, source_name: str):
        self.source_name = source_name
        self.session = requests.Session()
        
        # 配置代理
        if os.getenv('HTTP_PROXY'):
            proxies = {
                'http': os.getenv('HTTP_PROXY'),
                'https': os.getenv('HTTPS_PROXY'),
            }
            self.session.proxies.update(proxies)
        
        self.session.headers.update({
            'User-Agent': Config.USER_AGENT
        })
```

### 方案2: 使用Selenium + Chrome

已在 `base.py` 中实现 `_fetch_with_selenium` 方法。

安装依赖：
```bash
pip install selenium webdriver-manager
```

使用方式：
```python
html = crawler.fetch_page(url, use_selenium=True)
```

### 方案3: 使用备用数据源

#### 3.1 百度新闻搜索
已实现：`src/crawlers/baidu_news.py`

```bash
python src/crawlers/baidu_news.py
```

#### 3.2 RSS订阅源
已实现：`test_rss.py`

```bash
python test_rss.py
```

#### 3.3 其他AI资讯网站
- IT之家AI: https://www.ithome.com/blog/ai
- InfoQ AI: https://www.infoq.cn/topic/ai
- CSDN AI: https://blog.csdn.net/nav/ai

### 方案4: 本地开发使用模拟数据

虽然要求不使用mock，但在无法访问真实网站时，可以：

1. 从浏览器手动保存页面HTML
2. 修改测试代码直接读取本地HTML文件
3. 用于开发和测试解析逻辑

```python
# 读取本地HTML进行测试
with open('saved_page.html', 'r', encoding='utf-8') as f:
    html = f.read()
article = crawler.parse_detail(url, html)
```

## 推荐流程

1. **立即可用**: 使用百度新闻爬虫或RSS源获取真实数据
2. **配置代理**: 如果有代理工具（Clash、V2Ray等），配置后访问机器之心
3. **使用Selenium**: 处理JavaScript动态渲染的页面
4. **多源策略**: 同时使用多个数据源，提高稳定性

## 测试命令

```bash
# 测试机器之心（需要代理）
.\.venv\Scripts\python.exe test_jiqizhixin.py

# 测试百度新闻（无需代理）
.\.venv\Scripts\python.exe src\crawlers\baidu_news.py

# 测试RSS源（可能需要代理）
.\.venv\Scripts\python.exe test_rss.py
```

## 配置示例

### Clash代理配置

如果使用Clash：
1. 确保Clash在运行
2. 查看端口（通常是7890或7891）
3. 在 `.env` 添加：

```
HTTP_PROXY=http://127.0.0.1:7890
HTTPS_PROXY=http://127.0.0.1:7890
```

### V2Ray代理配置

如果使用V2Ray：
1. 查看本地SOCKS/HTTP端口
2. 配置到 `.env`

```
HTTP_PROXY=http://127.0.0.1:10809
HTTPS_PROXY=http://127.0.0.1:10809
```
